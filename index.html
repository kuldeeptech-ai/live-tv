<script>
let DATA;

fetch("data/channels.json")
  .then(res => res.json())
  .then(json => {
    DATA = json;
    renderCategories();
    renderChannels();
  });

function renderCategories() {
  const c = document.getElementById("categories");
  c.innerHTML = `<button onclick="renderChannels()">All</button>`;
  DATA.categories.forEach(cat => {
    const b = document.createElement("button");
    b.textContent = cat.name;
    b.onclick = () => renderChannels(cat.name);
    c.appendChild(b);
  });
}

function renderChannels(category) {
  const q = document.getElementById("search").value.toLowerCase();
  const g = document.getElementById("grid");
  g.innerHTML = "";

  DATA.categories.forEach(cat => {
    if (category && cat.name !== category) return;

    cat.channels.forEach(ch => {
      if (!ch.name.toLowerCase().includes(q)) return;

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="${ch.logo}">
        <span>${ch.name} (${ch.quality})</span>
      `;

      card.onclick = () => {
        localStorage.setItem("stream", ch.url);
        localStorage.setItem("title", ch.name);
        location.href = "player.html";
      };

      g.appendChild(card);
    });
  });
}

document.getElementById("search").oninput = () => renderChannels();
</script>
