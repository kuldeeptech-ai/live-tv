<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Live Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Plyr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css">

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15/dist/hls.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #0b0b0b;
  color: #fff;
  font-family: system-ui;
}

/* PLAYER CARD */
.player-card {
  max-width: 900px;
  margin: 16px auto;
  border-radius: 18px;
  overflow: hidden;
  border: 2px solid #2a2a2a;
  background: #000;
  box-shadow: 0 0 20px rgba(255,122,0,.15);
}

/* 16:9 */
.video-wrap {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
}

.video-wrap video {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: contain;
  background: #000;
}

/* NOW PLAYING */
.now-playing {
  position: absolute;
  top: 12px;
  left: 12px;
  z-index: 10;
  background: rgba(0,0,0,.65);
  border: 1px solid #ff7a00;
  color: #ff7a00;
  padding: 6px 10px;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 600;
}

/* Plyr theme */
:root {
  --plyr-color-main: #ff7a00;
}
</style>
</head>

<body>

<div class="player-card">
  <div class="now-playing" id="nowPlaying">Loadingâ€¦</div>
  <div class="video-wrap">
    <video
      id="video"
      playsinline
      webkit-playsinline
      preload="metadata"
      crossorigin="anonymous"
    ></video>
  </div>
</div>

<script>
const video = document.getElementById("video");
const nowPlaying = document.getElementById("nowPlaying");

let hls = null;

/* ===== INIT PLYR (NO AUTOPLAY, NO MUTE TRICKS) ===== */
const player = new Plyr(video, {
  controls: [
    'play',
    'progress',
    'current-time',
    'mute',
    'volume',
    'settings',
    'fullscreen'
  ]
});

/* ===== LOAD STREAM CORRECTLY ===== */
function loadStream(url, name) {
  if (!url) return;

  nowPlaying.textContent = "Now Playing: " + (name || "Live Channel");

  // Destroy old HLS
  if (hls) {
    hls.destroy();
    hls = null;
  }

  if (Hls.isSupported()) {
    hls = new Hls({
      enableWorker: true,
      capLevelToPlayerSize: true,
      startLevel: -1
    });

    hls.loadSource(url);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play().catch(() => {});
    });

    hls.on(Hls.Events.ERROR, (e, data) => {
      console.warn("HLS error", data);
    });

  } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
    video.src = url;
    video.addEventListener("loadedmetadata", () => {
      video.play().catch(() => {});
    }, { once: true });
  }

  localStorage.setItem("stream", url);
  localStorage.setItem("title", name || "Live Channel");
}

/* ===== RESTORE LAST PLAYED ===== */
const savedUrl = localStorage.getItem("stream");
const savedName = localStorage.getItem("title");

if (savedUrl) {
  loadStream(savedUrl, savedName);
}
</script>

</body>
</html>
